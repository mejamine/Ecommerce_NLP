product_data = [
    {"id": 1, "name": "Smartphone", "description": "A high-tech smartphone with a great camera and performance."},
    {"id": 2, "name": "Laptop", "description": "A powerful laptop with a fast processor and large storage."},
    {"id": 3, "name": "Headphones", "description": "Noise-canceling headphones with amazing sound quality."},
    {"id": 4, "name": "Smartwatch", "description": "A stylish smartwatch to track your fitness and health."},
    {"id": 5, "name": "Tablet", "description": "A lightweight tablet for media consumption and productivity."}
]
site_products = [
    {
        "_id": "670cd9589d3b71ac04e52f6c",
        "title": "product 1",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 6,
        "prix": 39,
        "discountPrix": 35,
        "type": "shirt",
        "vendue": 4,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895305259product1.jpg?alt=media&token=b84d8587-8f81-42e4-a48e-6985e9ba8285"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:42:00.862Z",
        "updatedAt": "2024-12-11T08:25:17.401Z",
        "__v": 0,
        "color": "soft brown cream",
        "gender": "Male , Female",
        "size": "S , M , L ,XL"
    },
    {
        "_id": "670cda059d3b71ac04e52f80",
        "title": "product 2",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 14,
        "prix": 49,
        "discountPrix": 45,
        "type": "t-shirt",
        "vendue": 6,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895490028product2.jpg?alt=media&token=dffb557f-845d-43af-9167-ef59f9dc5b73"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:44:53.917Z",
        "updatedAt": "2024-12-11T08:25:03.513Z",
        "__v": 0,
        "color": "white , soft orange",
        "gender": "Male , Female",
        "size": "S , M , L ,XL"
    },
    {
        "_id": "670cda279d3b71ac04e52f84",
        "title": "product 3",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 14,
        "prix": 49,
        "type": "t-shirt",
        "vendue": 1,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895523706product3.jpg?alt=media&token=07eb4a3a-4c04-46aa-8eb6-8ea3a4cce5ea"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:45:27.327Z",
        "updatedAt": "2024-12-11T08:26:07.618Z",
        "__v": 0,
        "color": "cream , grey , black , white , blue , brown",
        "gender": "Male , Female",
        "size": "S , M , L ,XL"
    },
    {
        "_id": "670cda689d3b71ac04e52f88",
        "title": "product 4",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 18,
        "prix": 40,
        "discountPrix": 38,
        "type": "shirt",
        "vendue": 2,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895560789product4.jpg?alt=media&token=13955267-0de8-448a-836e-39595d4a6c10"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:46:32.433Z",
        "updatedAt": "2024-12-11T08:26:41.847Z",
        "__v": 0,
        "color": "brown",
        "gender": "Female",
        "size": "S , M , L "
    },
    {
        "_id": "670cda899d3b71ac04e52f8c",
        "title": "product 5",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 10,
        "prix": 40,
        "discountPrix": 37,
        "type": "shirt",
        "vendue": 0,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895621242product5.jpg?alt=media&token=92906b05-8610-4589-ba32-26fee85646f8"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:47:05.312Z",
        "updatedAt": "2024-12-11T08:27:05.194Z",
        "__v": 0,
        "color": "cream , brown",
        "gender": "female",
        "size": "S , M , L "
    },
    {
        "_id": "670cdaa79d3b71ac04e52f90",
        "title": "product 6",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 9,
        "prix": 50,
        "discountPrix": 45,
        "type": "shirt",
        "vendue": 1,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895651290product6.jpg?alt=media&token=844567a6-7e75-4daf-ba70-f55b50a207d1"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:47:35.033Z",
        "updatedAt": "2024-12-11T08:27:48.549Z",
        "__v": 0,
        "color": "brown ",
        "gender": "Male , Female",
        "size": "S , M , L "
    },
    {
        "_id": "670cdacc9d3b71ac04e52f94",
        "title": "product 7",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 35,
        "prix": 39,
        "discountPrix": 35,
        "type": "jacket",
        "vendue": 0,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895683957product7.jpg?alt=media&token=0da7d179-b972-4c95-b506-f084759531aa"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:48:12.137Z",
        "updatedAt": "2024-12-11T08:28:42.574Z",
        "__v": 0,
        "color": "brown , cream , soft_blue , black",
        "gender": "Male",
        "size": "S , M , L "
    },
    {
        "_id": "670cdaea9d3b71ac04e52f98",
        "title": "product 8",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 12,
        "prix": 50,
        "discountPrix": 42,
        "type": "combination",
        "vendue": 0,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895718811product8.jpg?alt=media&token=8888d6c3-33b2-455a-a795-74dbe90d7800"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:48:42.582Z",
        "updatedAt": "2024-12-11T08:29:14.612Z",
        "__v": 0,
        "color": "brown",
        "gender": "Female",
        "size": "S , M "
    },
    {
        "_id": "670cdb0d9d3b71ac04e52f9c",
        "title": "product 9",
        "description": "description product in this area , you can add any description you want to .\nmake sure to put all the details so the client understands every thing and finds the best product",
        "quantite": 20,
        "prix": 45,
        "discountPrix": 42,
        "type": "shirt",
        "vendue": 0,
        "imgUrl": [
            "https://firebasestorage.googleapis.com/v0/b/ecommerce-403d4.appspot.com/o/1728895753417product9.jpg?alt=media&token=2b33a703-eda7-4def-a80a-d9d767c09e4b"
        ],
        "visite": 0,
        "createdAt": "2024-10-14T08:49:17.779Z",
        "updatedAt": "2024-12-11T08:29:49.043Z",
        "__v": 0,
        "color": "brown",
        "gender": "Male",
        "size": "L , XL"
    },
    {
        "_id": "675f7b1b5e0f5e4fa096c927",
        "title": "camera",
        "description": "camera description",
        "quantite": 10,
        "prix": 1000,
        "type": "camera",
        "vendue": 0,
        "color": "black",
        "size": "0",
        "gender": "none",
        "imgUrl": [
            "https://res.cloudinary.com/dwc6xwzko/image/upload/v1734310653/m4xoiwhrwlsnshfapmen.jpg"
        ],
        "visite": 0,
        "createdAt": "2024-12-16T00:58:03.692Z",
        "updatedAt": "2024-12-16T00:58:03.692Z",
        "__v": 0
    },
    {
        "_id": "675f7b4a5e0f5e4fa096c92b",
        "title": "camera",
        "description": "camera description",
        "quantite": 10,
        "prix": 1000,
        "type": "camera",
        "vendue": 0,
        "color": "brown",
        "size": "10",
        "gender": "none",
        "imgUrl": [
            "https://res.cloudinary.com/dwc6xwzko/image/upload/v1734310728/k96f1n5ixdhyfbjje7fr.jpg"
        ],
        "visite": 0,
        "createdAt": "2024-12-16T00:58:50.734Z",
        "updatedAt": "2024-12-16T00:58:50.734Z",
        "__v": 0
    },
    {
        "_id": "675f7b8b5e0f5e4fa096c92f",
        "title": "smart phone",
        "description": "apple",
        "quantite": 200,
        "prix": 2500,
        "type": "phone",
        "vendue": 0,
        "color": "grey",
        "size": "0",
        "gender": "0",
        "imgUrl": [
            "https://res.cloudinary.com/dwc6xwzko/image/upload/v1734310790/fwniguh6yyksk7y2urxl.jpg"
        ],
        "visite": 0,
        "createdAt": "2024-12-16T00:59:55.058Z",
        "updatedAt": "2024-12-16T00:59:55.058Z",
        "__v": 0
    },
    {
        "_id": "675f7bbb5e0f5e4fa096c933",
        "title": "smart phone",
        "description": "samsung",
        "quantite": 20,
        "prix": 4000,
        "type": "phone",
        "vendue": 0,
        "color": "blue",
        "size": "0",
        "gender": "0",
        "imgUrl": [
            "https://res.cloudinary.com/dwc6xwzko/image/upload/v1734310828/zvncvvmnkqg48ofwxels.jpg"
        ],
        "visite": 0,
        "createdAt": "2024-12-16T01:00:43.596Z",
        "updatedAt": "2024-12-16T01:00:43.596Z",
        "__v": 0
    },
    {
        "_id": "675f7bf45e0f5e4fa096c937",
        "title": "laptop",
        "description": "laptop descripton",
        "quantite": 10,
        "prix": 4000,
        "type": "laptop",
        "vendue": 0,
        "color": "black",
        "size": "0",
        "gender": "0",
        "imgUrl": [
            "https://res.cloudinary.com/dwc6xwzko/image/upload/v1734310875/s7mgmelmh9ghktejpebk.jpg"
        ],
        "visite": 0,
        "createdAt": "2024-12-16T01:01:40.734Z",
        "updatedAt": "2024-12-16T01:01:40.734Z",
        "__v": 0
    },
    {
        "_id": "675f7c1b5e0f5e4fa096c93b",
        "title": "laptop",
        "description": "laptop description",
        "quantite": 50,
        "prix": 5000,
        "type": "laptop",
        "vendue": 0,
        "color": "grey",
        "size": "0",
        "gender": "0",
        "imgUrl": [
            "https://res.cloudinary.com/dwc6xwzko/image/upload/v1734310932/gtacrk6s10cm7efyaux4.jpg"
        ],
        "visite": 0,
        "createdAt": "2024-12-16T01:02:19.963Z",
        "updatedAt": "2024-12-16T01:02:19.963Z",
        "__v": 0
    }
]
from flask import Flask, request, jsonify
import spacy
from flask_cors import CORS
app = Flask(__name__)
CORS(app, resources={r"/*": {"origins": "*"}})
nlp = spacy.load("en_core_web_sm")
def extract_keywords(text):
    doc = nlp(text)
    keywords = [token.lemma_ for token in doc if not token.is_stop and (token.pos_ == 'NOUN' )]
    return keywords
def compare_keywords(keywords1, keywords2):
    if not isinstance(keywords1, set):
        keywords1 = set(keywords1)
    if not isinstance(keywords2, set):
        keywords2 = set(keywords2)
    return len(keywords1.intersection(keywords2))

product_keywords = []
for product in product_data:
    keywords = extract_keywords(product['description'])
    product_keywords.append({"id": product['id'],"keywords": keywords})

product_incoming_key=[]
# Extract keywords for the database products
for product in site_products:
    keywords = extract_keywords(product['type'])
    product_incoming_key.append({"id": product['_id'],  "keywords": keywords})

# Compare keywords and recommend the best 2 products
recommendations = []
for product1 in product_incoming_key:
    for product2 in product_keywords:
        score = compare_keywords(product1['keywords'], product2['keywords'])
        recommendations.append({"product1": product1, "score": score})
recommendations.sort(key=lambda x: x['score'], reverse=True)
top_2_recommendations = recommendations[:2]
for product in top_2_recommendations :
    print (product['product1']['id'])
#Recommendation 1
@app.route('/recommend', methods=['POST'])
def recommend_products():
    # Prepare the response by serializing the top 2 recommendations
    response = [
        {"id": product['product1']['id']}
        for product in top_2_recommendations
    ]
    return jsonify(response)
@app.route('/text',methods=['POST'])
def recommend_products2():
    data = request.json  
    text = data.get('text')
    if not text:
        return jsonify({"error": "No text provided"}), 400
    keywords = extract_keywords(text)
    textKeyWords = {"keywords": set(keywords)}
    
    # Compare input keywords with product keywords
    recommendations = []
    for product in product_incoming_key:
        score = compare_keywords(textKeyWords['keywords'], product['keywords'])
        recommendations.append({"product": product, "score": score})
    
    # Sort recommendations by score in descending order and take the top 2
    recommendations.sort(key=lambda x: x['score'], reverse=True)
    response = recommendations[:2]
    res = [
        {"id": product['product']['id']}
        for product in response
    ]
    return jsonify({"res": res})

if __name__ == '__main__':
    app.run(debug=False)
